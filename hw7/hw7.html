<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stochastic Process Explorer</title>
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <nav class="navbar navbar-dark bg-dark">
            <span class="navbar-brand mb-0 h1">Stochastic Process Explorer</span>
        </nav>
    </header>

    <main class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="processSelect">Select a Stochastic Process:</label>
                    <select id="processSelect" class="form-control">
                        <option value="geometricBrownianMotion">Geometric Brownian Motion</option>
                        <option value="arithmeticBrownianMotion">Arithmetic Brownian Motion</option>
                        <option value="hullWhite">Hull - White</option>
                        <option value="coxIngellRoss">Cox-Ingell-Ross</option>
                        <option value="ornestein">Ornestein</option>
                        <option value="vasicek">Vasicek</option>
                        <!-- Add more options for other stochastic processes -->
                    </select>
                </div>
                <button id="exploreBtn" class="btn btn-primary">Explore</button>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="Nmachine">Insert the numer of the machines</label>
                    <input type="number" id="Nmachine" class="form-control" value="3">

                    <label for="mu" class="Math">Insert the percentage drift \(\mu\)</label>
                    <input type="number" id="mu" class="form-control" value="0.1">

                    <label for="timeMax">Insert the max time</label>
                    <input type="number" id="timeMax" class="form-control" value="100">

                    <label for="dt">Insert the time step</label>
                    <input type="number" id="dt" class="form-control" value="0.01">
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <canvas id="visualization" width="1000" height="500"></canvas>
            </div>
            <div id="theoryAll">
                <div id="theoryGBM" style="display: none;">
                    <p class="lead">The Geometric Brownian Process</p>
                    <p>
                        The geometric brownian motion  is a continuous-time stochastic process in which the logarithm of the randomly varying quantity follows a Brownian motion which is 
                        the random motion of particles suspended in a medium. The SDE that GBM satisfies is:
                        <div class="Math">
                            \[
                            dS_t= \mu S_t dt + \sigma S_t dW(t)
                            \]
                        </div>
                        Where: 
                        <ul >
                            <li><span class="Math">\(W_t\)</span> is a <a href="https://en.wikipedia.org/wiki/Wiener_process">Wiener process</a></li>
                            <li><span class="Math">\(\mu\)</span> is a constant that indicates the percentage drift</li>
                            <li><span class="Math">\(\sigma\)</span> is a constant that indicates the percentage volatility</li>
                        </ul>
                        the first addend is used to calculate and model deterministic trends while the second one tries to model non deterministic and unpredictable events during the process.
                    </p>
                </div>
                <div id="theoryABM" style="display: none;">
                    <p class="lead">The Arithmetic Brownian Motion</p>
                    <p>
                        The arithmetic brownian motion is a "normalized" continuous-time stochastic process derived by the geometric one.
                        This process satisfies the following system:
                        <div class="Math">
                            \[
                            dX_t = m dt + v dW_t
                            \]
                        </div>
                        Where:
                        <ul>
                            <li><span class="Math">\(X_t\) = ln(frac{S_t}{S_0})</span></li>
                            <li><span class="Math">\[m\]</span> and <span class="Math">v</span> are constant.</li>
                        </ul>
                        and for <span class="Math">\[X_0\]</span> as initial condition we have Arithmetic Brownian Motion. We can get to ABM from GBM by simply exchanging logarithm and exp combined with <a href="https://en.wikipedia.org/wiki/It%C3%B4%27s_lemma">Ito's formula'</a>.
                    </p>
                </div>
                <div id="theoryHW" style="display: none;">
                    <p class="lead">Hull-White model</p>
                    <p>
                        The Hull-White model is a model of future interests and it follows this dinamic:
                        <div class="Math">
                            \[
                            dr(t) = [\theta(t) - \alpha(t)r(t)] dt +\sigma(t)dW(t)
                            \]
                        </div>
                        if only <span class="Math">\[\theta\]</span> is time dependent we are talking about the Hull-White model, otherwise we are talking about the extended Vasicek model.
                    </p>
                </div>
                <div id="theoryCIR" style="display: none;">
                    <p class="lead">Cox-Ingell-Ross model/p>
                        <p>
                            The Cox-Ingell-Ross model is a financial "one-factor" model as it describes interests rate movements
                            as driven by only one source of risk. The model is the following:
                            <div class="Math">
                                \[
                                dr_t = a(b - r_t) dt + \sigma \sqrt{r_t}dW_t
                                \]
                            </div>
                            Where
                            <ul>
                                <li><span class="Math">\[W_t\]</span> is a Wiener Process</li>
                                <li><span class="Math">\[a\]</span> is the speed of adjustment to the mean <span class="Math">b</span></li>
                                <li><span class="Math">\[\sigma\]</span> is the volatility</li>
                            </ul>
                            Like the GBM or other stochastic process we have the drift factor. In this case it's the dt's coefficient.
                        </p>
                </div>
                <div id="theoryOrnestein" style="display: none;">
                    <p class="lead">Ornestein</p>
                    <p>
                        The Ornstein–Uhlenbeck process is a stationary Gauss–Markov process, which means that it is a Gaussian process, a Markov process. It is defined by:
                        <div class="Math">
                            \[
                            dx_t = -\theta x_t + \sigma dW_t
                            \]
                        </div>
                        Where
                        <ul>
                            <li><span class="Math">\[\theta\]</span> and <span class="Math">\[\sigma\]</span> are positive parameters</li>
                            <li><span>\[W_t\]</span> is a Wiener Process</li>
                        </ul>
                        The process can be considered to be a modification of the random walk in continuous time, or Wiener process, in which the properties of the process have been changed so that there is a tendency of the walk to move back towards a central location, with a greater attraction when the process is further away from the center
                    </p>
                </div>
                <div id="theoryVasicek" style="display: none;">
                    <p class="lead">Vasicek</p>
                    <p>
                        The model specifies that the instantaneous interest rate follows the stochastic differential equation: 
                        <div class="Math">
                            \[
                            dr_t = a(b-r_t)dt+W_t 
                            \]
                        </div>
                        Where:
                        <ul>
                            <li><span class="Math">\[b\]</span> is long term mean level: All future trajectories of r r will evolve around a mean level b in the long run</li>
                            <li><span class="Math">\[a\]</span> "speed of reversion". a a characterizes the velocity at which such trajectories will regroup around b b in time</li>
                            <li> <span class="Math">\[\sigma]</span> "instantaneous volatility", measures instant by instant the amplitude of randomness entering the system. Higher <span>\[\sigma\]</span> implies more randomness</li>
                            <li><span class="Math">\[frac{\sigma^2}{2a}\]</span>: "long term variance". All future trajectories of r r will regroup around the long term mean with such variance after a long time.</li>
                        </ul>
                        
                    </p>
                </div>
            </div>
            
        </div>
    </main>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        const canva = document.getElementById('visualization');
        const ctx = canva.getContext('2d');
       
        // Define functions to simulate stochastic processes
        function simulateGeometricBrownianMotion() {
            console.log('starting simulation');
            const mu = parseFloat(document.getElementById('mu').value);
            const n = parseInt(document.getElementById('Nmachine').value);
            const dt = parseFloat(document.getElementById('dt').value);
            const x0 = 100;
            const seed = 1;

            const sigma = [];
            for (let s = 0.8; s < 2; s += 0.2) {
                sigma.push(s);
            }
            console.log(`sigma = ${sigma}`);

            const width = canva.width;
            const height = canva.height;
            console.log(`height = ${height}, width = ${width}`);
            for (let i = 0; i < sigma.length; i++) {
                let path = [x0];
                console.log(`x0 = ${x0}`);
                for (let j = 0; j < n; j++) {
                    const randomNormal = gaussianRandom(); //thanks to CLT we know that our distribution will approximate a gaussian one with larger n. (to keep in mind anyway is that having larger n means more time for computation and also that we can't have true randomness in a general purpose pc).
                    //actually calculating the numerical value using the solution formula for geometric brownian motion
                    const increment = Math.exp((mu - Math.pow(sigma[i], 2) / 2) * dt + sigma[i] * randomNormal);
                    const newValue = path[path.length - 1] * increment; //incrementing the path based on the last computed value

                    const lastX = (j / n) * width;
                    const lastY = (height / 2) - (newValue / x0);
                    

                    path.push(newValue); //pushing the new value in the path

                    if(j === 0){
                        ctx.moveTo(0, height);
                    }
                    ctx.lineTo(lastX, lastY);
                }
                ctx.stroke();
            }

        }

        function simulateArithmeticBrownianMotion() {


        }

        function gaussianRandom(mean=0, stdev=1) {
            const u = 1 - Math.random(); // Converting [0,1) to (0,1]
            const v = Math.random();
            const z = Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );
            // Transform to the desired mean and standard deviation:
            return z * stdev + mean;
        }

        // Get references to HTML elements
        const processSelect = document.getElementById('processSelect');
        const exploreBtn = document.getElementById('exploreBtn');
        const visualization = document.getElementById('visualization').getContext('2d');

        // Function to handle exploration based on user selection
        function exploreStochasticProcess() {
            const selectedProcess = processSelect.value;

            // Clear previous visualizations
            visualization.clearRect(0, 0, visualization.canvas.width, visualization.canvas.height);
            const theoryGBM = document.getElementById('theoryGBM');
            const theoryABM = document.getElementById('theoryABM');
            const theoryHW = document.getElementById('theoryHW');
            const theoryCIR = document.getElementById('coxIngellRoss');
            const theoryOrnestein = document.getElementById('theoryOrnestein');
            const theoryVasicek = document.getElementById('theoryVasicek');
            theoryGBM.style.display = "none";
            theoryABM.style.display = "none";
            theoryHW.style.display = "none";
            //theoryCIR.style.display = "none";
            //theoryOrnestein.style.display = "none";
            //theoryVasicek.style.display = "none";
            // Simulate and display the selected stochastic process
            switch (selectedProcess) {
                
                case 'geometricBrownianMotion':
                    simulateGeometricBrownianMotion();
                    
                    if(theoryGBM.style.display === "none"){
                        theoryGBM.style.display = "block";
                    } 
                    break;
                case 'arithmeticBrownianMotion':
                    simulateArithmeticBrownianMotion();
                    
                    if(theoryABM.style.display === "none"){
                        theoryABM.style.display = "block";
                    }
                    break;
                case 'hullWhite':
                    simulateHullWhite();
                    if(theoryHW.style.display === "none"){
                        theoryHW.style.display = "block";
                    }
                case 'coxIngellRoss':
                    simulateCoxIngellRoss();
                    if(theoryCIR.style.display === "none"){
                        theoryCIR.style.display = "block";
                    }
                case 'ornestein':
                    simulateOrnestein();
                    if(theoryOrnestein.style.display === "none"){
                        theoryOrnestein.style.display = "block";
                    }
                case 'vasicek':
                    simulateVasicek();
                    if(theoryVasicek.style.display === "none"){
                        theoryVasicek.style.display = "block";
                    }
                // Add cases for other stochastic processes
                default:
                    // Handle invalid selection
                    break;
            }
        }

        // Event listener for the explore button
        exploreBtn.addEventListener('click', exploreStochasticProcess);

        function renderMath() {
            MathJax.typesetPromise([
                document.getElementsByClassName('Math')
            ]);
        }

        // Check if MathJax is loaded, then render equations
        if (window.MathJax) {
            renderMath();
        } else {
            window.addEventListener('load', renderMath);
        }
    </script>
</body>
</html>
